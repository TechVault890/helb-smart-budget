<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELB Smart Budget - Complete Financial Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a5f2a;
            --primary-light: #2d8a44;
            --primary-dark: #0f4d1f;
            --success: #28a745;
            --success-light: #34ce57;
            --success-dark: #1e7e34;
            --warning: #ffc107;
            --warning-light: #ffd350;
            --warning-dark: #e0a800;
            --danger: #dc3545;
            --danger-light: #e15361;
            --danger-dark: #c82333;
            --info: #17a2b8;
            --info-light: #3ab7cc;
            --info-dark: #138496;
            --gray: #6c757d;
            --gray-light: #8fa0ad;
            --gray-dark: #495057;
            --light: #f8f9fa;
            --dark: #343a40;
            --sidebar-bg: #0f4d1f;
            --sidebar-hover: #1a5f2a;
            --card-bg: #ffffff;
            --body-bg: #f0f7f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--body-bg);
            color: var(--dark);
            line-height: 1.6;
        }

        /* Login System Styles */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .login-container.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .login-title {
            color: var(--primary-dark);
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        .login-tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }

        .login-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .login-tab.active {
            background: var(--primary);
            color: white;
        }

        .login-form {
            display: none;
        }

        .login-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .login-footer {
            margin-top: 20px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .login-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .demo-accounts {
            margin-top: 20px;
            padding: 15px;
            background: #f8fff8;
            border-radius: 10px;
            border-left: 4px solid var(--success);
        }

        .demo-account {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .demo-account:hover {
            border-color: var(--primary);
            background: #f8fff8;
        }

        /* Password Reset Styles */
        .reset-steps {
            display: none;
        }

        .reset-steps.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .reset-success {
            text-align: center;
            padding: 20px;
            background: #d4edda;
            border-radius: 10px;
            border-left: 4px solid var(--success);
            margin: 20px 0;
        }

        .reset-success i {
            font-size: 3rem;
            color: var(--success);
            margin-bottom: 15px;
        }

        /* Profile Settings Styles */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }

        .profile-avatar-large {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.8rem;
        }

        .profile-info h2 {
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .profile-info p {
            color: var(--gray);
        }

        .settings-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .settings-section h3 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar-options {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .avatar-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease;
            background: linear-gradient(135deg, var(--primary), var(--success));
        }

        .avatar-option:hover {
            transform: scale(1.1);
        }

        .avatar-option.selected {
            border: 3px solid var(--primary);
            box-shadow: 0 0 0 2px var(--success-light);
        }

        .danger-zone {
            border-left: 4px solid var(--danger);
        }

        .danger-zone h3 {
            color: var(--danger);
        }

        /* Data Export Styles */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .export-option {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .export-option:hover {
            transform: translateY(-3px);
            border-color: var(--success-light);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .export-option.selected {
            border-color: var(--success);
            background: #f8fff8;
        }

        .export-option i {
            font-size: 2.5rem;
            color: var(--success);
            margin-bottom: 15px;
        }

        .export-format {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-format:hover {
            border-color: var(--primary);
            background: #f8fff8;
        }

        .export-format.selected {
            border-color: var(--success);
            background: #f8fff8;
        }

        /* Main App Container */
        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--sidebar-bg), var(--primary-dark));
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .logo {
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            color: var(--success-light);
            font-size: 1.8rem;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .nav-links li:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: var(--success-light);
        }

        .nav-links li.active {
            background: rgba(255,255,255,0.15);
            border-left-color: var(--success-light);
            font-weight: 600;
        }

        .nav-links i {
            width: 20px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.1rem;
        }

        .user-name {
            font-weight: 600;
            color: var(--dark);
        }

        .user-status {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Page Management */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card Styles */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .card.primary { border-left-color: var(--primary); }
        .card.success { border-left-color: var(--success); }
        .card.warning { border-left-color: var(--warning); }
        .card.info { border-left-color: var(--info); }

        .card h3 {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card.primary .amount { color: var(--primary); }
        .card.success .amount { color: var(--success); }
        .card.warning .amount { color: var(--warning-dark); }
        .card.info .amount { color: var(--info); }

        .card-footer {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Section Titles */
        .section-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--success);
        }

        /* Smart Alerts */
        .smart-alerts {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid var(--warning);
        }

        .smart-alerts h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            margin: 10px 0;
            background: #fff9e6;
            border-radius: 10px;
            border-left: 4px solid var(--warning);
        }

        .alert-item i {
            color: var(--warning-dark);
            margin-top: 2px;
        }

        /* Quick Actions */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .quick-action {
            background: white;
            padding: 25px 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 2px solid transparent;
        }

        .quick-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: var(--success-light);
        }

        .quick-action i {
            font-size: 2.5rem;
            color: var(--success);
            margin-bottom: 15px;
        }

        .quick-action span {
            font-weight: 600;
            color: var(--dark);
        }

        /* AI Insights */
        .ai-insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .insight-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-top: 4px solid var(--success);
        }

        .insight-icon {
            font-size: 2rem;
            color: var(--success);
            margin-bottom: 15px;
        }

        .insight-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .insight-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Expense List */
        .expense-list {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .expense-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            padding: 20px;
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .expense-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            padding: 20px;
            border-bottom: 1px solid var(--light);
            transition: background-color 0.3s ease;
        }

        .expense-item:hover {
            background-color: #f8fff8;
        }

        .expense-item:last-child {
            border-bottom: none;
        }

        /* Progress Bars */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-safe { background: var(--success); }
        .progress-warning { background: var(--warning); }
        .progress-danger { background: var(--danger); }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--success));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-secondary {
            background: var(--gray-light);
            color: white;
        }

        /* Additional styles for new features */
        .savings-goals {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .goal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin: 15px 0;
            background: #f8fff8;
            border-radius: 12px;
            border-left: 5px solid var(--success);
            transition: transform 0.3s ease;
        }

        .goal-item:hover {
            transform: translateX(5px);
        }
        
        .goal-progress {
            flex: 1;
            margin: 0 20px;
        }
        
        .analytics-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .quick-pay-section {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .quick-pay-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .quick-pay-btn {
            background: rgba(255,255,255,0.15);
            padding: 20px 15px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .quick-pay-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-3px);
            border-color: rgba(255,255,255,0.3);
        }
        
        .quick-pay-btn i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--success-light);
        }
        
        .bill-reminder {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 5px solid var(--warning);
        }
        
        .financial-tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .tip-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid var(--info);
            transition: transform 0.3s ease;
        }

        .tip-card:hover {
            transform: translateY(-5px);
        }

        .tip-card i {
            font-size: 2rem;
            color: var(--success);
            margin-bottom: 15px;
        }

        .tip-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* Budget Categories */
        .budget-categories {
            display: grid;
            gap: 20px;
            margin: 25px 0;
        }

        .category-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid var(--primary);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-name {
            font-weight: 600;
            color: var(--dark);
        }

        .category-amount {
            font-weight: 700;
            color: var(--primary);
        }

        /* Payment Status */
        .payment-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-paid {
            background: #d4edda;
            color: var(--success-dark);
        }

        .status-pending {
            background: #fff3cd;
            color: var(--warning-dark);
        }

        /* Money Pulse */
        .money-pulse {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .pulse-chart {
            max-width: 300px;
            margin: 0 auto 20px;
        }

        .summary-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 10px;
        }

        .summary-label {
            color: var(--gray);
            font-size: 1.1rem;
        }

        /* Financial Summary */
        .financial-summary {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 20px;
            background: #f8fff8;
            border-radius: 12px;
            border: 2px solid #e9ffe9;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        /* Enhanced Form Validation Styles */
        .form-control.invalid {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .form-control.valid {
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .validation-message {
            font-size: 0.85rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .validation-message.error {
            color: var(--danger);
        }

        .validation-message.success {
            color: var(--success);
        }

        /* Loading States */
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Button States */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Improved Modal Backdrop */
        .modal {
            backdrop-filter: blur(5px);
        }

        /* Better Responsive Tables */
        @media (max-width: 768px) {
            .expense-header {
                display: none;
            }
            
            .expense-item {
                display: block;
                padding: 15px;
                border-bottom: 1px solid var(--light);
            }
            
            .expense-item > div {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
            }
            
            .expense-item > div::before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--gray);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .nav-links {
                display: flex;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .nav-links li {
                flex-shrink: 0;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .nav-links li.active {
                border-left: none;
                border-bottom: 3px solid var(--success-light);
            }
            
            .expense-header,
            .expense-item {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }

        /* Animation for notifications */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            animation: slideIn 0.3s ease;
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.info {
            background: var(--info);
        }

        .notification.warning {
            background: var(--warning);
        }
    </style>
</head>
<body>
    <!-- Login System -->
    <div id="loginContainer" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h1 class="login-title">HELB Smart Budget</h1>
            
            <div class="login-tabs">
                <button class="login-tab active" data-tab="login">Login</button>
                <button class="login-tab" data-tab="signup">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="login-form active">
                <div class="form-group">
                    <input type="email" id="loginEmail" class="form-control" placeholder="Email Address" required>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" class="form-control" placeholder="Password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Login to Dashboard
                </button>
                
                <div class="demo-accounts">
                    <p style="margin-bottom: 10px; color: var(--gray); font-size: 0.9rem;">
                        <i class="fas fa-lightbulb"></i> Try demo accounts:
                    </p>
                    <div class="demo-account" data-email="student@uon.ac.ke" data-password="demo123">
                        <strong>John Kariuki</strong> - University of Nairobi
                    </div>
                    <div class="demo-account" data-email="mary@ku.ac.ke" data-password="demo123">
                        <strong>Mary Wanjiku</strong> - Kenyatta University
                    </div>
                    <div class="demo-account" data-email="peter@jkuat.ac.ke" data-password="demo123">
                        <strong>Peter Kamau</strong> - JKUAT
                    </div>
                </div>
                
                <!-- Forgot Password Link -->
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" class="forgot-password" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">
                        <i class="fas fa-key"></i> Forgot Password?
                    </a>
                </div>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="login-form">
                <div class="form-group">
                    <input type="text" id="signupName" class="form-control" placeholder="Full Name" required>
                </div>
                <div class="form-group">
                    <input type="email" id="signupEmail" class="form-control" placeholder="Email Address" required>
                </div>
                <div class="form-group">
                    <input type="text" id="signupUniversity" class="form-control" placeholder="University" required>
                </div>
                <div class="form-group">
                    <input type="password" id="signupPassword" class="form-control" placeholder="Create Password" required>
                </div>
                <div class="form-group">
                    <input type="password" id="signupConfirmPassword" class="form-control" placeholder="Confirm Password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </form>

            <!-- Password Reset Form -->
            <form id="resetForm" class="login-form">
                <div class="reset-steps active" id="resetStep1">
                    <div class="form-group">
                        <label for="resetEmail">Enter your email address</label>
                        <input type="email" id="resetEmail" class="form-control" placeholder="your-email@university.ac.ke" required>
                    </div>
                    <button type="button" class="btn btn-primary" id="sendResetCode" style="width: 100%;">
                        <i class="fas fa-paper-plane"></i> Send Reset Code
                    </button>
                    <div style="text-align: center; margin-top: 15px;">
                        <a href="#" class="back-to-login" style="color: var(--primary); text-decoration: none;">
                            <i class="fas fa-arrow-left"></i> Back to Login
                        </a>
                    </div>
                </div>

                <div class="reset-steps" id="resetStep2">
                    <div class="form-group">
                        <label for="resetCode">Enter reset code</label>
                        <input type="text" id="resetCode" class="form-control" placeholder="Enter 6-digit code" maxlength="6" required>
                        <small style="color: var(--gray);">Check your email for the reset code</small>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" class="form-control" placeholder="Enter new password" required>
                    </div>
                    <button type="button" class="btn btn-primary" id="resetPassword" style="width: 100%;">
                        <i class="fas fa-lock"></i> Reset Password
                    </button>
                </div>

                <div class="reset-steps" id="resetSuccess">
                    <div class="reset-success">
                        <i class="fas fa-check-circle"></i>
                        <h3>Password Reset Successful!</h3>
                        <p>Your password has been updated successfully.</p>
                        <button type="button" class="btn btn-primary" id="goToLogin">
                            <i class="fas fa-sign-in-alt"></i> Go to Login
                        </button>
                    </div>
                </div>
            </form>

            <div class="login-footer">
                <p>By continuing, you agree to our <a href="#">Terms of Service</a></p>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-graduation-cap logo-icon"></i> HELB Smart Budget</h1>
            </div>
            <ul class="nav-links">
                <li class="active" data-page="dashboard"><i class="fas fa-home"></i> Dashboard</li>
                <li data-page="ai-advisor"><i class="fas fa-robot"></i> AI Advisor</li>
                <li data-page="budget"><i class="fas fa-wallet"></i> Budget Allocation</li>
                <li data-page="bills"><i class="fas fa-file-invoice-dollar"></i> My Bills</li>
                <li data-page="payments"><i class="fas fa-credit-card"></i> Make Payments</li>
                <li data-page="expenses"><i class="fas fa-receipt"></i> Expenses</li>
                <li data-page="savings"><i class="fas fa-piggy-bank"></i> Savings Goals</li>
                <li data-page="analytics"><i class="fas fa-chart-pie"></i> Analytics</li>
                <li data-page="financial-tips"><i class="fas fa-lightbulb"></i> Financial Tips</li>
                <li data-page="data-export"><i class="fas fa-download"></i> Data Export</li>
                <li data-page="profile-settings"><i class="fas fa-user-cog"></i> Profile Settings</li>
                <li id="logoutBtn" style="border-top: 1px solid rgba(255,255,255,0.1); margin-top: 20px; padding-top: 20px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 id="page-title">Student Finance Dashboard</h1>
                <div class="user-info">
                    <div class="avatar" id="userAvatar">JK</div>
                    <div>
                        <div class="user-name" id="userDisplayName">John Kariuki</div>
                        <div class="user-status" id="userUniversity">University of Nairobi</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="dashboard-cards">
                    <div class="card primary">
                        <h3>Total HELB Funds</h3>
                        <div class="amount">KSh <span id="total-helb">68,000</span></div>
                        <div class="card-footer">This Semester</div>
                    </div>
                    <div class="card success">
                        <h3>Available Balance</h3>
                        <div class="amount">KSh <span id="available-balance">42,150</span></div>
                        <div class="card-footer">Ready to use</div>
                    </div>
                    <div class="card warning">
                        <h3>Total Spent</h3>
                        <div class="amount">KSh <span id="total-spent">25,850</span></div>
                        <div class="card-footer">This Semester</div>
                    </div>
                    <div class="card info">
                        <h3>Budget Health</h3>
                        <div class="amount" id="budget-health">Good</div>
                        <div class="card-footer" id="budget-status">All categories within limits</div>
                    </div>
                </div>

                <!-- AI Smart Alerts -->
                <div class="smart-alerts">
                    <h4><i class="fas fa-bell"></i> Smart Alerts</h4>
                    <div class="alert-item">
                        <i class="fas fa-lightbulb"></i>
                        <span>You can save <strong>KSh 2,400</strong> this month by cooking at home 3 more days per week</span>
                    </div>
                    <div class="alert-item">
                        <i class="fas fa-chart-line"></i>
                        <span>Your food spending is <strong>28% higher</strong> than students with similar budgets</span>
                    </div>
                </div>

                <!-- Quick Pay Section -->
                <div class="quick-pay-section">
                    <h3><i class="fas fa-bolt"></i> Quick Pay Bills</h3>
                    <div class="quick-pay-buttons">
                        <div class="quick-pay-btn" data-bill="electricity">
                            <i class="fas fa-bolt"></i>
                            <div>Electricity</div>
                            <small>KSh 1,500</small>
                        </div>
                        <div class="quick-pay-btn" data-bill="tuition">
                            <i class="fas fa-graduation-cap"></i>
                            <div>Tuition</div>
                            <small>KSh 26,000</small>
                        </div>
                        <div class="quick-pay-btn" data-bill="rent">
                            <i class="fas fa-home"></i>
                            <div>Rent</div>
                            <small>KSh 9,000</small>
                        </div>
                        <div class="quick-pay-btn" data-bill="internet">
                            <i class="fas fa-wifi"></i>
                            <div>Internet</div>
                            <small>KSh 1,200</small>
                        </div>
                    </div>
                </div>

                <!-- Money Pulse -->
                <div class="money-pulse">
                    <h4><i class="fas fa-heartbeat"></i> Financial Health Pulse</h4>
                    <div class="pulse-chart">
                        <canvas id="pulseChart"></canvas>
                    </div>
                    <div style="text-align: center;">
                        <div class="summary-value">78%</div>
                        <div class="summary-label">Overall Financial Health Score</div>
                    </div>
                </div>

                <h2 class="section-title">Quick Actions</h2>
                <div class="quick-actions-grid">
                    <div class="quick-action" id="quick-budget">
                        <i class="fas fa-wallet"></i>
                        <span>Manage Budget</span>
                    </div>
                    <div class="quick-action" id="quick-bills">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>View Bills</span>
                    </div>
                    <div class="quick-action" id="quick-pay">
                        <i class="fas fa-credit-card"></i>
                        <span>Pay Bill</span>
                    </div>
                    <div class="quick-action" id="quick-ai">
                        <i class="fas fa-robot"></i>
                        <span>AI Advisor</span>
                    </div>
                </div>

                <!-- Quick AI Insights -->
                <div class="ai-insights">
                    <div class="insight-card">
                        <div class="insight-icon"><i class="fas fa-piggy-bank"></i></div>
                        <div class="insight-label">Monthly Savings Potential</div>
                        <div class="insight-value">KSh 3,850</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon"><i class="fas fa-calendar"></i></div>
                        <div class="insight-label">Days Until Next HELB</div>
                        <div class="insight-value">42</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon"><i class="fas fa-trending-up"></i></div>
                        <div class="insight-label">Spending Trend</div>
                        <div class="insight-value">-12%</div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <h2 class="section-title">Recent Transactions</h2>
                <div class="expense-list">
                    <div class="expense-header">
                        <div>Description</div>
                        <div>Category</div>
                        <div>Date</div>
                        <div>Amount</div>
                        <div>Status</div>
                    </div>
                    <div id="recent-transactions">
                        <!-- Recent transactions will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- AI Advisor Page -->
            <div id="ai-advisor" class="page">
                <h2 class="section-title"><i class="fas fa-robot"></i> AI Financial Advisor</h2>
                
                <div class="smart-alerts">
                    <h4><i class="fas fa-comment-alt"></i> Ask AI Advisor</h4>
                    <div class="form-group">
                        <input type="text" id="ai-question" class="form-control" placeholder="Ask me anything about your finances, budgeting, or savings...">
                    </div>
                    <button class="btn btn-primary" id="ask-ai-btn">
                        <i class="fas fa-paper-plane"></i> Ask Question
                    </button>
                </div>

                <div class="ai-response-area">
                    <div class="card" style="background: linear-gradient(135deg, #f8fff8, #e8f5e8);">
                        <h3><i class="fas fa-brain"></i> AI Recommendations</h3>
                        <div id="ai-recommendations">
                            <div class="alert-item">
                                <i class="fas fa-piggy-bank"></i>
                                <span><strong>Savings Opportunity:</strong> You could save KSh 1,200 monthly by reducing eating out from 10 to 5 times per month</span>
                            </div>
                            <div class="alert-item">
                                <i class="fas fa-chart-line"></i>
                                <span><strong>Budget Optimization:</strong> Your transport budget is underutilized. Consider reallocating KSh 2,000 to food category</span>
                            </div>
                            <div class="alert-item">
                                <i class="fas fa-lightbulb"></i>
                                <span><strong>Smart Tip:</strong> Start an emergency fund with 5% of your HELB money. You've saved 32% of your KSh 5,000 goal!</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="financial-tips-grid" style="margin-top: 30px;">
                    <div class="tip-card">
                        <i class="fas fa-calculator"></i>
                        <h3>Budget Analysis</h3>
                        <p>Your current spending pattern shows good discipline in major categories. Focus on optimizing food expenses for better savings.</p>
                    </div>
                    <div class="tip-card">
                        <i class="fas fa-trophy"></i>
                        <h3>Achievement</h3>
                        <p>You're in the top 25% of students for financial management. Keep tracking your expenses daily!</p>
                    </div>
                </div>
            </div>

            <!-- Budget Allocation Page -->
            <div id="budget" class="page">
                <h2 class="section-title"><i class="fas fa-wallet"></i> Budget Allocation</h2>
                
                <div class="budget-summary-card">
                    <div class="card success">
                        <h3>Total HELB Funds Available</h3>
                        <div class="amount">KSh <span id="total-helb-budget">68,000</span></div>
                        <div class="card-footer">Semester Allocation</div>
                    </div>
                </div>

                <div class="savings-goals">
                    <h3><i class="fas fa-plus-circle"></i> Allocate Funds to Categories</h3>
                    <div class="form-group">
                        <label for="category">Select Category</label>
                        <select id="category" class="form-control">
                            <option value="">Choose a category...</option>
                            <option value="tuition">Tuition Fees</option>
                            <option value="accommodation">Accommodation</option>
                            <option value="food">Food & Meals</option>
                            <option value="transport">Transport</option>
                            <option value="books">Books & Supplies</option>
                            <option value="utilities">Utilities</option>
                            <option value="personal">Personal Expenses</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">Amount (KSh)</label>
                        <input type="number" id="amount" class="form-control" placeholder="Enter amount to allocate">
                        <small id="available-amount" style="color: var(--success); margin-top: 5px; display: block;"></small>
                    </div>
                    <button class="btn btn-primary" id="allocate-btn">
                        <i class="fas fa-check-circle"></i> Allocate Funds
                    </button>
                </div>

                <h3 class="section-title">Current Budget Allocation</h3>
                <div id="budget-categories-list">
                    <!-- Budget categories will be dynamically added here -->
                </div>

                <div class="allocation-summary">
                    <div class="card info">
                        <h3>Allocation Summary</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-label">Total Allocated</div>
                                <div class="summary-value">KSh <span id="allocated-total">0</span></div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Remaining Funds</div>
                                <div class="summary-value">KSh <span id="remaining-funds">68,000</span></div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Allocation Progress</div>
                                <div class="summary-value"><span id="allocation-percent">0%</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- My Bills Page -->
            <div id="bills" class="page">
                <h2 class="section-title"><i class="fas fa-file-invoice-dollar"></i> My Bills & Payments</h2>
                
                <div class="bill-reminder">
                    <h4><i class="fas fa-exclamation-triangle"></i> Upcoming Bill Reminder</h4>
                    <p>Internet bill of KSh 1,200 is due in 3 days. Consider paying early to avoid service interruption.</p>
                </div>

                <div class="bills-list">
                    <h3>Current Bills</h3>
                    <div id="bills-container">
                        <!-- Bills will be dynamically added here -->
                    </div>
                </div>

                <div class="payment-history">
                    <h3 class="section-title">Payment History</h3>
                    <div class="expense-list">
                        <div class="expense-header">
                            <div>Bill Description</div>
                            <div>Category</div>
                            <div>Payment Date</div>
                            <div>Amount</div>
                            <div>Status</div>
                        </div>
                        <div id="payment-history-list">
                            <!-- Payment history will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Make Payments Page -->
            <div id="payments" class="page">
                <h2 class="section-title"><i class="fas fa-credit-card"></i> Make Payments</h2>
                
                <div class="savings-goals">
                    <h3><i class="fas fa-money-check-alt"></i> New Payment</h3>
                    <div class="form-group">
                        <label for="payment-category">Payment Category</label>
                        <select id="payment-category" class="form-control">
                            <option value="">Select category...</option>
                            <option value="tuition">Tuition Fees</option>
                            <option value="accommodation">Accommodation</option>
                            <option value="food">Food & Meals</option>
                            <option value="transport">Transport</option>
                            <option value="books">Books & Supplies</option>
                            <option value="utilities">Utilities</option>
                            <option value="personal">Personal Expenses</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-description">Description</label>
                        <input type="text" id="payment-description" class="form-control" placeholder="Enter payment description">
                    </div>
                    <div class="form-group">
                        <label for="payment-amount">Amount (KSh)</label>
                        <input type="number" id="payment-amount" class="form-control" placeholder="Enter amount">
                    </div>
                    
                    <div class="form-group">
                        <label>Payment Method</label>
                        <div class="payment-methods">
                            <div class="quick-actions-grid">
                                <div class="quick-action payment-method active" data-method="mpesa">
                                    <i class="fas fa-mobile-alt"></i>
                                    <span>M-Pesa</span>
                                </div>
                                <div class="quick-action payment-method" data-method="card">
                                    <i class="fas fa-credit-card"></i>
                                    <span>Card</span>
                                </div>
                                <div class="quick-action payment-method" data-method="bank">
                                    <i class="fas fa-university"></i>
                                    <span>Bank Transfer</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="process-payment">
                        <i class="fas fa-paper-plane"></i> Process Payment
                    </button>
                </div>

                <div class="quick-pay-section" style="margin-top: 30px;">
                    <h3><i class="fas fa-bolt"></i> Quick Pay Options</h3>
                    <div class="quick-pay-buttons">
                        <div class="quick-pay-btn" data-bill="electricity">
                            <i class="fas fa-bolt"></i>
                            <div>Electricity</div>
                            <small>KSh 1,500</small>
                        </div>
                        <div class="quick-pay-btn" data-bill="tuition">
                            <i class="fas fa-graduation-cap"></i>
                            <div>Tuition</div>
                            <small>KSh 26,000</small>
                        </div>
                        <div class="quick-pay-btn" data-bill="rent">
                            <i class="fas fa-home"></i>
                            <div>Rent</div>
                            <small>KSh 9,000</small>
                        </div>
                        <div class="quick-pay-btn" data-bill="internet">
                            <i class="fas fa-wifi"></i>
                            <div>Internet</div>
                            <small>KSh 1,200</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Expenses Page -->
            <div id="expenses" class="page">
                <h2 class="section-title"><i class="fas fa-receipt"></i> Expense Tracking</h2>
                
                <div class="savings-goals">
                    <h3><i class="fas fa-plus-circle"></i> Add New Expense</h3>
                    <div class="form-group">
                        <label for="expense-category">Expense Category</label>
                        <select id="expense-category" class="form-control">
                            <option value="">Select category...</option>
                            <option value="tuition">Tuition Fees</option>
                            <option value="accommodation">Accommodation</option>
                            <option value="food">Food & Meals</option>
                            <option value="transport">Transport</option>
                            <option value="books">Books & Supplies</option>
                            <option value="utilities">Utilities</option>
                            <option value="personal">Personal Expenses</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expense-description">Description</label>
                        <input type="text" id="expense-description" class="form-control" placeholder="Enter expense description">
                    </div>
                    <div class="form-group">
                        <label for="expense-amount">Amount (KSh)</label>
                        <input type="number" id="expense-amount" class="form-control" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label for="expense-date">Date</label>
                        <input type="date" id="expense-date" class="form-control">
                    </div>
                    <button class="btn btn-primary" id="add-expense-btn">
                        <i class="fas fa-plus-circle"></i> Add Expense
                    </button>
                </div>

                <h3 class="section-title">Recent Expenses</h3>
                <div class="expense-list">
                    <div class="expense-header">
                        <div>Description</div>
                        <div>Category</div>
                        <div>Date</div>
                        <div>Amount</div>
                        <div>Status</div>
                    </div>
                    <div id="expenses-list">
                        <!-- Expenses will be dynamically added here -->
                    </div>
                </div>
            </div>

            <!-- Savings Goals Page -->
            <div id="savings" class="page">
                <h2 class="section-title"><i class="fas fa-piggy-bank"></i> Savings Goals</h2>
                
                <div class="savings-goals">
                    <h3><i class="fas fa-bullseye"></i> Create New Savings Goal</h3>
                    <div class="form-group">
                        <label for="goal-name">Goal Name</label>
                        <input type="text" id="goal-name" class="form-control" placeholder="e.g., New Laptop, Emergency Fund">
                    </div>
                    <div class="form-group">
                        <label for="goal-target">Target Amount (KSh)</label>
                        <input type="number" id="goal-target" class="form-control" placeholder="Enter target amount">
                    </div>
                    <div class="form-group">
                        <label for="goal-deadline">Target Date</label>
                        <input type="date" id="goal-deadline" class="form-control">
                    </div>
                    <button class="btn btn-primary" id="add-goal-btn">
                        <i class="fas fa-plus-circle"></i> Create Goal
                    </button>
                </div>

                <h3 class="section-title">Your Savings Goals</h3>
                <div id="savings-goals-list">
                    <!-- Savings goals will be dynamically added here -->
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <h2 class="section-title"><i class="fas fa-chart-pie"></i> Financial Analytics</h2>
                
                <div class="analytics-charts">
                    <div class="chart-card">
                        <h3>Spending by Category</h3>
                        <canvas id="categoryChart" height="250"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Monthly Spending Trend</h3>
                        <canvas id="trendChart" height="250"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Budget vs Actual</h3>
                        <canvas id="budgetChart" height="250"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Savings Progress</h3>
                        <canvas id="savingsChart" height="250"></canvas>
                    </div>
                </div>

                <div class="financial-summary">
                    <h3><i class="fas fa-chart-bar"></i> Key Metrics</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">Monthly Average Spend</div>
                            <div class="summary-value">KSh 8,617</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Largest Expense</div>
                            <div class="summary-value">Tuition (KSh 24,700)</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Savings Rate</div>
                            <div class="summary-value">18%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Tips Page -->
            <div id="financial-tips" class="page">
                <h2 class="section-title"><i class="fas fa-lightbulb"></i> Financial Tips for Students</h2>
                
                <div class="financial-tips-grid">
                    <div class="tip-card">
                        <i class="fas fa-utensils"></i>
                        <h3>Save on Food</h3>
                        <p>Cook meals in bulk with friends to save money and time. Eating out regularly can consume a large portion of your budget.</p>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-book"></i>
                        <h3>Textbook Savings</h3>
                        <p>Buy used textbooks, rent them, or use library copies. Consider digital versions which are often cheaper.</p>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-bus"></i>
                        <h3>Transport Hacks</h3>
                        <p>Use student discounts on public transport. Walk or bike when possible to save money and stay healthy.</p>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-piggy-bank"></i>
                        <h3>Emergency Fund</h3>
                        <p>Always set aside 5-10% of your HELB money for unexpected expenses. This prevents you from going into debt.</p>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-chart-line"></i>
                        <h3>Track Spending</h3>
                        <p>Use this app to monitor where your money goes. Small daily expenses add up significantly over time.</p>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-hand-holding-usd"></i>
                        <h3>Part-Time Work</h3>
                        <p>Consider a part-time job or freelance work that fits your schedule to supplement your HELB funds.</p>
                    </div>
                </div>
            </div>

            <!-- Profile Settings Page -->
            <div id="profile-settings" class="page">
                <h2 class="section-title"><i class="fas fa-user-cog"></i> Profile Settings</h2>
                
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profileAvatarLarge">JK</div>
                    <div class="profile-info">
                        <h2 id="profileUserName">John Kariuki</h2>
                        <p id="profileUserEmail">student@uon.ac.ke</p>
                        <p id="profileUserUniversity">University of Nairobi</p>
                    </div>
                </div>

                <div class="settings-section">
                    <h3><i class="fas fa-user-edit"></i> Personal Information</h3>
                    <div class="form-group">
                        <label for="editName">Full Name</label>
                        <input type="text" id="editName" class="form-control" value="John Kariuki">
                    </div>
                    <div class="form-group">
                        <label for="editUniversity">University</label>
                        <input type="text" id="editUniversity" class="form-control" value="University of Nairobi">
                    </div>
                    <div class="form-group">
                        <label>Profile Avatar</label>
                        <div class="avatar-options">
                            <div class="avatar-option selected" data-avatar="JK">JK</div>
                            <div class="avatar-option" data-avatar="US">US</div>
                            <div class="avatar-option" data-avatar="ST">ST</div>
                            <div class="avatar-option" data-avatar="HE">HE</div>
                            <div class="avatar-option" data-avatar="LB">LB</div>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="saveProfile">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>

                <div class="settings-section">
                    <h3><i class="fas fa-lock"></i> Security</h3>
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password">
                    </div>
                    <div class="form-group">
                        <label for="newProfilePassword">New Password</label>
                        <input type="password" id="newProfilePassword" class="form-control" placeholder="Enter new password">
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">Confirm New Password</label>
                        <input type="password" id="confirmNewPassword" class="form-control" placeholder="Confirm new password">
                    </div>
                    <button class="btn btn-primary" id="changePassword">
                        <i class="fas fa-key"></i> Change Password
                    </button>
                </div>

                <div class="settings-section danger-zone">
                    <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                    <p style="color: var(--gray); margin-bottom: 20px;">
                        Once you delete your account, there is no going back. Please be certain.
                    </p>
                    <button class="btn" style="background: var(--danger); color: white;" id="deleteAccount">
                        <i class="fas fa-trash"></i> Delete My Account
                    </button>
                </div>
            </div>

            <!-- Data Export Page -->
            <div id="data-export" class="page">
                <h2 class="section-title"><i class="fas fa-download"></i> Data Export</h2>
                
                <div class="settings-section">
                    <h3><i class="fas fa-file-export"></i> Export Your Financial Data</h3>
                    <p style="color: var(--gray); margin-bottom: 20px;">
                        Download your financial data for record keeping, analysis, or sharing with financial advisors.
                    </p>

                    <div class="export-options">
                        <div class="export-option selected" data-type="transactions">
                            <i class="fas fa-receipt"></i>
                            <h4>Transactions</h4>
                            <p>All your payments and expenses</p>
                        </div>
                        <div class="export-option" data-type="budget">
                            <i class="fas fa-wallet"></i>
                            <h4>Budget</h4>
                            <p>Budget allocations and spending</p>
                        </div>
                        <div class="export-option" data-type="savings">
                            <i class="fas fa-piggy-bank"></i>
                            <h4>Savings Goals</h4>
                            <p>Savings progress and targets</p>
                        </div>
                        <div class="export-option" data-type="all">
                            <i class="fas fa-archive"></i>
                            <h4>Complete Data</h4>
                            <p>All your financial data</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Export Format</label>
                        <div class="export-format selected" data-format="csv">
                            <i class="fas fa-file-csv" style="color: var(--success);"></i>
                            <div>
                                <strong>CSV Format</strong>
                                <small style="color: var(--gray);">Compatible with Excel and Google Sheets</small>
                            </div>
                        </div>
                        <div class="export-format" data-format="pdf">
                            <i class="fas fa-file-pdf" style="color: var(--danger);"></i>
                            <div>
                                <strong>PDF Report</strong>
                                <small style="color: var(--gray);">Printable formatted report</small>
                            </div>
                        </div>
                        <div class="export-format" data-format="json">
                            <i class="fas fa-file-code" style="color: var(--info);"></i>
                            <div>
                                <strong>JSON Data</strong>
                                <small style="color: var(--gray);">For developers and analysis</small>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" id="exportData" style="width: 100%;">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>

                <div class="settings-section">
                    <h3><i class="fas fa-history"></i> Export History</h3>
                    <div id="exportHistory">
                        <p style="color: var(--gray); text-align: center; padding: 40px;">
                            <i class="fas fa-clock" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                            No export history yet
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Confirmation Modal -->
    <div id="payment-confirmation" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-check-circle" style="color: var(--success);"></i> Payment Successful</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Your payment has been processed successfully!</p>
                <div class="payment-details">
                    <p><strong>Amount:</strong> KSh <span id="confirm-amount">0</span></p>
                    <p><strong>Description:</strong> <span id="confirm-description"></span></p>
                    <p><strong>Transaction ID:</strong> <span id="transaction-id">TXN-</span></p>
                </div>
            </div>
            <div class="modal-footer" style="text-align: right; margin-top: 20px;">
                <button class="btn btn-primary" id="close-payment-modal">Done</button>
            </div>
        </div>
    </div>

    <!-- Budget Warning Modal -->
    <div id="budget-warning-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i> Budget Warning</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>This payment will exceed your budget allocation for this category.</p>
                <div class="budget-details">
                    <p><strong>Category:</strong> <span id="warning-category"></span></p>
                    <p><strong>Allocated:</strong> KSh <span id="warning-allocated">0</span></p>
                    <p><strong>Already Spent:</strong> KSh <span id="warning-spent">0</span></p>
                    <p><strong>This Payment:</strong> KSh <span id="warning-payment">0</span></p>
                    <p><strong>Remaining After:</strong> KSh <span id="warning-remaining" style="color: var(--danger); font-weight: bold;">0</span></p>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" id="cancel-payment">Cancel</button>
                <button class="btn btn-primary" id="proceed-anyway">Proceed Anyway</button>
            </div>
        </div>
    </div>

    <script>
        // ===== LOGIN SYSTEM =====
        const userAccounts = {
            'student@uon.ac.ke': {
                password: 'demo123',
                name: 'John Kariuki',
                university: 'University of Nairobi',
                avatar: 'JK'
            },
            'mary@ku.ac.ke': {
                password: 'demo123',
                name: 'Mary Wanjiku',
                university: 'Kenyatta University',
                avatar: 'MW'
            },
            'peter@jkuat.ac.ke': {
                password: 'demo123',
                name: 'Peter Kamau',
                university: 'JKUAT',
                avatar: 'PK'
            }
        };

        let currentUser = null;

        function initializeLoginSystem() {
            setupLoginEventListeners();
            setupPasswordReset();
            setupProfileSettings();
            setupDataExport();
            checkExistingSession();
        }

        function setupLoginEventListeners() {
            document.querySelectorAll('.login-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.login-form').forEach(form => form.classList.remove('active'));
                    document.getElementById(tabName + 'Form').classList.add('active');
                });
            });

            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });

            document.getElementById('signupForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleSignup();
            });

            document.querySelectorAll('.demo-account').forEach(account => {
                account.addEventListener('click', function() {
                    const email = this.getAttribute('data-email');
                    const password = this.getAttribute('data-password');
                    document.getElementById('loginEmail').value = email;
                    document.getElementById('loginPassword').value = password;
                    setTimeout(() => handleLogin(), 500);
                });
            });

            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
        }

        // ===== PASSWORD RESET FUNCTIONALITY =====
        function setupPasswordReset() {
            // Forgot password link
            document.querySelector('.forgot-password').addEventListener('click', function(e) {
                e.preventDefault();
                showResetForm();
            });

            document.querySelector('.back-to-login').addEventListener('click', function(e) {
                e.preventDefault();
                showLoginForm();
            });

            document.getElementById('sendResetCode').addEventListener('click', sendResetCode);
            document.getElementById('resetPassword').addEventListener('click', resetPassword);
            document.getElementById('goToLogin').addEventListener('click', showLoginForm);
        }

        function showResetForm() {
            document.querySelectorAll('.login-form').forEach(form => form.classList.remove('active'));
            document.getElementById('resetForm').classList.add('active');
            showResetStep(1);
        }

        function showLoginForm() {
            document.querySelectorAll('.login-form').forEach(form => form.classList.remove('active'));
            document.getElementById('loginForm').classList.add('active');
            document.querySelector('.login-tab.active').click();
        }

        function showResetStep(step) {
            document.querySelectorAll('.reset-steps').forEach(step => step.classList.remove('active'));
            document.getElementById(`resetStep${step}`).classList.add('active');
        }

        function sendResetCode() {
            const email = document.getElementById('resetEmail').value;
            
            if (!email) {
                showNotification('Please enter your email address', 'error');
                return;
            }

            if (!userAccounts[email]) {
                showNotification('No account found with this email address', 'error');
                return;
            }

            // Simulate sending reset code
            const resetCode = Math.floor(100000 + Math.random() * 900000).toString();
            userAccounts[email].resetCode = resetCode;
            userAccounts[email].resetCodeExpiry = Date.now() + 10 * 60 * 1000; // 10 minutes

            showNotification(`Reset code sent to ${email} (Demo: ${resetCode})`, 'success');
            showResetStep(2);
        }

        function resetPassword() {
            const email = document.getElementById('resetEmail').value;
            const code = document.getElementById('resetCode').value;
            const newPassword = document.getElementById('newPassword').value;

            if (!code || !newPassword) {
                showNotification('Please enter reset code and new password', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }

            const user = userAccounts[email];
            if (!user || user.resetCode !== code) {
                showNotification('Invalid reset code', 'error');
                return;
            }

            if (user.resetCodeExpiry && Date.now() > user.resetCodeExpiry) {
                showNotification('Reset code has expired', 'error');
                return;
            }

            // Update password
            user.password = newPassword;
            delete user.resetCode;
            delete user.resetCodeExpiry;

            showResetStep(3);
            showNotification('Password reset successfully!', 'success');
        }

        // ===== USER PROFILE FUNCTIONALITY =====
        function setupProfileSettings() {
            // Profile event listeners
            document.getElementById('saveProfile').addEventListener('click', saveProfile);
            document.getElementById('changePassword').addEventListener('click', changePassword);
            document.getElementById('deleteAccount').addEventListener('click', deleteAccount);
            
            // Avatar selection
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }

        function loadProfileData() {
            if (!currentUser) return;
            
            // Update profile page
            document.getElementById('profileUserName').textContent = currentUser.name;
            document.getElementById('profileUserEmail').textContent = currentUser.email;
            document.getElementById('profileUserUniversity').textContent = currentUser.university;
            document.getElementById('profileAvatarLarge').textContent = currentUser.avatar;
            
            // Update form fields
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editUniversity').value = currentUser.university;
            
            // Set selected avatar
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
                if (option.getAttribute('data-avatar') === currentUser.avatar) {
                    option.classList.add('selected');
                }
            });
        }

        function saveProfile() {
            if (!currentUser) return;
            
            const newName = document.getElementById('editName').value;
            const newUniversity = document.getElementById('editUniversity').value;
            const selectedAvatar = document.querySelector('.avatar-option.selected').getAttribute('data-avatar');
            
            if (!newName || !newUniversity) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            // Update user data
            currentUser.name = newName;
            currentUser.university = newUniversity;
            currentUser.avatar = selectedAvatar;
            
            // Update accounts storage
            userAccounts[currentUser.email] = currentUser;
            localStorage.setItem('helbCurrentUser', JSON.stringify(currentUser));
            
            // Update UI
            document.getElementById('userDisplayName').textContent = newName;
            document.getElementById('userUniversity').textContent = newUniversity;
            document.getElementById('userAvatar').textContent = selectedAvatar;
            
            showNotification('Profile updated successfully!', 'success');
        }

        function changePassword() {
            if (!currentUser) return;
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newProfilePassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Please fill in all password fields', 'error');
                return;
            }
            
            if (currentPassword !== userAccounts[currentUser.email].password) {
                showNotification('Current password is incorrect', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('New password must be at least 6 characters', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }
            
            // Update password
            userAccounts[currentUser.email].password = newPassword;
            currentUser.password = newPassword;
            localStorage.setItem('helbCurrentUser', JSON.stringify(currentUser));
            
            // Clear fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newProfilePassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
            
            showNotification('Password changed successfully!', 'success');
        }

        function deleteAccount() {
            if (!currentUser) return;
            
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                if (confirm('This will permanently delete all your data. Type "DELETE" to confirm:')) {
                    // Remove from accounts
                    delete userAccounts[currentUser.email];
                    localStorage.removeItem('helbCurrentUser');
                    currentUser = null;
                    
                    showLogin();
                    showNotification('Account deleted successfully', 'info');
                }
            }
        }

        // ===== DATA EXPORT FUNCTIONALITY =====
        function setupDataExport() {
            // Export option selection
            document.querySelectorAll('.export-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.export-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Format selection
            document.querySelectorAll('.export-format').forEach(format => {
                format.addEventListener('click', function() {
                    document.querySelectorAll('.export-format').forEach(f => f.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Export button
            document.getElementById('exportData').addEventListener('click', exportData);
        }

        function exportData() {
            const selectedType = document.querySelector('.export-option.selected')?.getAttribute('data-type') || 'transactions';
            const selectedFormat = document.querySelector('.export-format.selected')?.getAttribute('data-format') || 'csv';
            
            if (!currentUser) return;

            // Prepare data based on selection
            let data = {};
            switch (selectedType) {
                case 'transactions':
                    data = prepareTransactionData();
                    break;
                case 'budget':
                    data = prepareBudgetData();
                    break;
                case 'savings':
                    data = prepareSavingsData();
                    break;
                case 'all':
                    data = prepareAllData();
                    break;
            }

            // Export based on format
            switch (selectedFormat) {
                case 'csv':
                    exportToCSV(data, selectedType);
                    break;
                case 'pdf':
                    exportToPDF(data, selectedType);
                    break;
                case 'json':
                    exportToJSON(data, selectedType);
                    break;
            }

            // Add to export history
            addToExportHistory(selectedType, selectedFormat);
            showNotification(`Data exported as ${selectedFormat.toUpperCase()}`, 'success');
        }

        function prepareTransactionData() {
            const transactions = [];
            Object.values(state.categories).forEach(category => {
                if (category.bills) {
                    category.bills.forEach(bill => {
                        transactions.push({
                            Description: bill.name,
                            Category: category.name,
                            Amount: `KSh ${bill.amount}`,
                            Date: bill.date,
                            Status: bill.status
                        });
                    });
                }
            });
            return transactions;
        }

        function prepareBudgetData() {
            return Object.values(state.categories).map(category => ({
                Category: category.name,
                Allocated: `KSh ${category.allocated}`,
                Spent: `KSh ${category.spent}`,
                Remaining: `KSh ${category.allocated - category.spent}`,
                Utilization: `${((category.spent / category.allocated) * 100).toFixed(1)}%`
            }));
        }

        function prepareSavingsData() {
            return state.savingsGoals.map(goal => ({
                Goal: goal.name,
                Target: `KSh ${goal.target}`,
                Saved: `KSh ${goal.current}`,
                Remaining: `KSh ${goal.target - goal.current}`,
                Progress: `${((goal.current / goal.target) * 100).toFixed(1)}%`,
                Deadline: goal.deadline
            }));
        }

        function prepareAllData() {
            return {
                user: currentUser,
                transactions: prepareTransactionData(),
                budget: prepareBudgetData(),
                savings: prepareSavingsData(),
                summary: {
                    totalHelb: state.totalHelb,
                    totalSpent: state.spentTotal,
                    availableBalance: state.availableBalance
                },
                exportDate: new Date().toISOString()
            };
        }

        function exportToCSV(data, type) {
            let csvContent = '';
            
            if (Array.isArray(data)) {
                // Headers
                const headers = Object.keys(data[0]);
                csvContent += headers.join(',') + '\n';
                
                // Rows
                data.forEach(row => {
                    const values = headers.map(header => `"${row[header]}"`);
                    csvContent += values.join(',') + '\n';
                });
            } else {
                // For nested data (all export)
                csvContent = 'Data Type,Details\n';
                Object.entries(data).forEach(([key, value]) => {
                    if (Array.isArray(value)) {
                        csvContent += `${key},${value.length} records\n`;
                    } else {
                        csvContent += `${key},"${JSON.stringify(value)}"\n`;
                    }
                });
            }
            
            downloadFile(csvContent, `helb-${type}-${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
        }

        function exportToJSON(data, type) {
            const jsonContent = JSON.stringify(data, null, 2);
            downloadFile(jsonContent, `helb-${type}-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
        }

        function exportToPDF(data, type) {
            // Simple PDF simulation - in real app, use a library like jsPDF
            let pdfContent = `HELB Smart Budget Export\n`;
            pdfContent += `Generated: ${new Date().toLocaleString()}\n`;
            pdfContent += `User: ${currentUser.name}\n`;
            pdfContent += `Type: ${type}\n\n`;
            
            if (Array.isArray(data)) {
                data.forEach(item => {
                    Object.entries(item).forEach(([key, value]) => {
                        pdfContent += `${key}: ${value}\n`;
                    });
                    pdfContent += '---\n';
                });
            } else {
                pdfContent += JSON.stringify(data, null, 2);
            }
            
            downloadFile(pdfContent, `helb-${type}-${new Date().toISOString().split('T')[0]}.txt`, 'text/plain');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function addToExportHistory(type, format) {
            const history = JSON.parse(localStorage.getItem('exportHistory') || '[]');
            history.unshift({
                type: type,
                format: format,
                date: new Date().toISOString(),
                filename: `helb-${type}-${new Date().toISOString().split('T')[0]}.${format}`
            });
            
            // Keep only last 10 exports
            if (history.length > 10) history.pop();
            
            localStorage.setItem('exportHistory', JSON.stringify(history));
            renderExportHistory();
        }

        function renderExportHistory() {
            const history = JSON.parse(localStorage.getItem('exportHistory') || '[]');
            const container = document.getElementById('exportHistory');
            
            if (history.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--gray); text-align: center; padding: 40px;">
                        <i class="fas fa-clock" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                        No export history yet
                    </p>
                `;
                return;
            }
            
            container.innerHTML = history.map(item => `
                <div class="export-history-item" style="padding: 15px; border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: between; align-items: center;">
                        <div>
                            <strong>${item.type.charAt(0).toUpperCase() + item.type.slice(1)} Data</strong>
                            <div style="color: var(--gray); font-size: 0.9rem;">
                                ${item.format.toUpperCase()}  ${new Date(item.date).toLocaleDateString()}
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="reDownloadExport('${item.filename}')" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function reDownloadExport(filename) {
            showNotification('Re-download functionality would connect to your cloud storage in a real app', 'info');
        }

        // ===== ORIGINAL APP FUNCTIONS =====
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }

            if (userAccounts[email] && userAccounts[email].password === password) {
                currentUser = { email: email, ...userAccounts[email] };
                localStorage.setItem('helbCurrentUser', JSON.stringify(currentUser));
                showApp();
                showNotification(`Welcome back, ${currentUser.name}!`, 'success');
            } else {
                showNotification('Invalid email or password', 'error');
            }
        }

        function handleSignup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const university = document.getElementById('signupUniversity').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;

            if (!name || !email || !university || !password || !confirmPassword) {
                showNotification('Please fill in all fields', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }

            if (userAccounts[email]) {
                showNotification('An account with this email already exists', 'error');
                return;
            }

            userAccounts[email] = {
                password: password,
                name: name,
                university: university,
                avatar: name.split(' ').map(n => n[0]).join('').toUpperCase()
            };

            currentUser = { email: email, ...userAccounts[email] };
            localStorage.setItem('helbCurrentUser', JSON.stringify(currentUser));
            showApp();
            showNotification(`Account created successfully! Welcome, ${name}!`, 'success');
        }

        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('helbCurrentUser');
            showLogin();
            showNotification('You have been logged out successfully', 'info');
        }

        function checkExistingSession() {
            const savedUser = localStorage.getItem('helbCurrentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginForm').reset();
            document.getElementById('signupForm').reset();
        }

        function showApp() {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('appContainer').style.display = 'flex';
            
            if (currentUser) {
                document.getElementById('userDisplayName').textContent = currentUser.name;
                document.getElementById('userUniversity').textContent = currentUser.university;
                document.getElementById('userAvatar').textContent = currentUser.avatar;
            }
            
            initializeApp();
        }

        // ===== COMPREHENSIVE STATE MANAGEMENT & MISSING FUNCTIONS =====
        const state = {
            totalHelb: 68000,
            allocatedTotal: 0,
            spentTotal: 25850,
            availableBalance: 42150,
            
            categories: {
                tuition: {
                    name: "Tuition Fees",
                    allocated: 26000,
                    spent: 24700,
                    limit: 95,
                    bills: [
                        { name: "Semester Tuition", amount: 24700, date: "2023-01-15", status: "paid" }
                    ]
                },
                accommodation: {
                    name: "Accommodation", 
                    allocated: 18000,
                    spent: 9000,
                    limit: 90,
                    bills: [
                        { name: "Hostel Rent", amount: 9000, date: "2023-01-18", status: "paid" }
                    ]
                },
                food: {
                    name: "Food & Meals",
                    allocated: 12000, 
                    spent: 3600,
                    limit: 85,
                    bills: []
                },
                transport: {
                    name: "Transport",
                    allocated: 6000,
                    spent: 0,
                    limit: 80,
                    bills: []
                },
                books: {
                    name: "Books & Supplies",
                    allocated: 4000,
                    spent: 2850,
                    limit: 85,
                    bills: [
                        { name: "Textbooks", amount: 2850, date: "2023-01-22", status: "paid" }
                    ]
                },
                utilities: {
                    name: "Utilities",
                    allocated: 3000,
                    spent: 1500,
                    limit: 80,
                    bills: [
                        { name: "Electricity", amount: 1500, date: "2023-01-20", status: "paid" }
                    ]
                },
                personal: {
                    name: "Personal Expenses",
                    allocated: 2000,
                    spent: 1200,
                    limit: 85,
                    bills: []
                }
            },
            
            savingsGoals: [
                {
                    id: 1,
                    name: "Emergency Fund",
                    target: 5000,
                    current: 3200,
                    deadline: "2023-06-30",
                    completed: false
                },
                {
                    id: 2,
                    name: "New Laptop",
                    target: 80000,
                    current: 15000,
                    deadline: "2024-01-31",
                    completed: false
                }
            ],
            
            paymentHistory: [],
            expenses: []
        };

        function calculateBudgetTotals() {
            let allocated = 0;
            let spent = 0;
            
            Object.values(state.categories).forEach(category => {
                allocated += category.allocated;
                spent += category.spent;
            });
            
            state.allocatedTotal = allocated;
            state.spentTotal = spent;
            state.availableBalance = state.totalHelb - spent;
            
            updateBudgetDisplay();
        }

        function updateBudgetDisplay() {
            document.getElementById('total-helb').textContent = state.totalHelb.toLocaleString();
            document.getElementById('allocated-total').textContent = state.allocatedTotal.toLocaleString();
            document.getElementById('total-spent').textContent = state.spentTotal.toLocaleString();
            document.getElementById('available-balance').textContent = state.availableBalance.toLocaleString();
            document.getElementById('remaining-funds').textContent = (state.totalHelb - state.allocatedTotal).toLocaleString();
            
            const allocationPercent = ((state.allocatedTotal / state.totalHelb) * 100).toFixed(1);
            document.getElementById('allocation-percent').textContent = allocationPercent + '%';
            
            // Update budget health
            const healthElement = document.getElementById('budget-health');
            const statusElement = document.getElementById('budget-status');
            const healthPercentage = ((state.availableBalance / state.totalHelb) * 100);
            
            if (healthPercentage > 40) {
                healthElement.textContent = 'Excellent';
                healthElement.style.color = 'var(--success)';
                statusElement.textContent = 'Great financial health!';
            } else if (healthPercentage > 20) {
                healthElement.textContent = 'Good';
                healthElement.style.color = 'var(--warning)';
                statusElement.textContent = 'Manage your spending carefully';
            } else {
                healthElement.textContent = 'Critical';
                healthElement.style.color = 'var(--danger)';
                statusElement.textContent = 'Review your expenses immediately';
            }
        }

        function updateAllDisplays() {
            updateBudgetDisplay();
            renderBudgetCategories();
            renderBills();
            renderExpenses();
            renderRecentTransactions();
            renderPaymentHistory();
            renderSavingsGoals();
        }

        function setupEventListeners() {
            // Quick action buttons
            document.getElementById('quick-budget').addEventListener('click', () => switchPage('budget'));
            document.getElementById('quick-bills').addEventListener('click', () => switchPage('bills'));
            document.getElementById('quick-pay').addEventListener('click', () => switchPage('payments'));
            document.getElementById('quick-ai').addEventListener('click', () => switchPage('ai-advisor'));
            
            // Budget allocation
            document.getElementById('allocate-btn').addEventListener('click', allocateFunds);
            document.getElementById('category').addEventListener('change', updateAvailableAmount);
            
            // Payments and expenses
            document.getElementById('process-payment').addEventListener('click', processPayment);
            document.getElementById('add-expense-btn').addEventListener('click', addExpense);
            document.getElementById('add-goal-btn').addEventListener('click', addSavingsGoal);
            
            // AI Advisor
            document.getElementById('ask-ai-btn').addEventListener('click', askAIAdvisor);
            
            // Payment method selection
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Modal handlers
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });
            
            document.getElementById('close-payment-modal').addEventListener('click', closeAllModals);
            document.getElementById('cancel-payment').addEventListener('click', closeAllModals);
            document.getElementById('proceed-anyway').addEventListener('click', proceedWithPayment);
        }

        function switchPage(pageId) {
            document.querySelectorAll('.nav-links li').forEach(li => li.classList.remove('active'));
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            
            const navItem = document.querySelector(`[data-page="${pageId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            document.getElementById(pageId).classList.add('active');
            
            // Update page title
            const titles = {
                dashboard: 'Student Finance Dashboard',
                'ai-advisor': 'AI Financial Advisor',
                budget: 'Budget Allocation',
                bills: 'My Bills & Payments',
                payments: 'Make Payments',
                expenses: 'Expense Tracking',
                savings: 'Savings Goals',
                analytics: 'Financial Analytics',
                'financial-tips': 'Financial Tips',
                'data-export': 'Data Export',
                'profile-settings': 'Profile Settings'
            };
            document.getElementById('page-title').textContent = titles[pageId] || 'HELB Smart Budget';
        }

        // ===== BUDGET ALLOCATION FUNCTIONS =====
        function updateAvailableAmount() {
            const categorySelect = document.getElementById('category');
            const selectedCategory = categorySelect.value;
            const availableSpan = document.getElementById('available-amount');
            
            if (selectedCategory && state.categories[selectedCategory]) {
                const remaining = state.totalHelb - state.allocatedTotal;
                availableSpan.textContent = `Available to allocate: KSh ${remaining.toLocaleString()}`;
            } else {
                availableSpan.textContent = '';
            }
        }

        function allocateFunds() {
            const categorySelect = document.getElementById('category');
            const amountInput = document.getElementById('amount');
            
            const categoryKey = categorySelect.value;
            const amount = parseFloat(amountInput.value);
            
            if (!categoryKey) {
                showNotification('Please select a category', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            
            const remainingFunds = state.totalHelb - state.allocatedTotal;
            if (amount > remainingFunds) {
                showNotification(`Only KSh ${remainingFunds.toLocaleString()} available to allocate`, 'error');
                return;
            }
            
            // Update category allocation
            state.categories[categoryKey].allocated += amount;
            
            // Clear form
            categorySelect.value = '';
            amountInput.value = '';
            document.getElementById('available-amount').textContent = '';
            
            // Update displays
            calculateBudgetTotals();
            renderBudgetCategories();
            
            showNotification(`Successfully allocated KSh ${amount.toLocaleString()} to ${state.categories[categoryKey].name}`, 'success');
        }

        // ===== PAYMENT PROCESSING FUNCTIONS =====
        function processPayment() {
            const category = document.getElementById('payment-category').value;
            const description = document.getElementById('payment-description').value;
            const amount = parseFloat(document.getElementById('payment-amount').value);
            const method = document.querySelector('.payment-method.active')?.getAttribute('data-method');
            
            // Validation
            if (!category || !description || !amount || !method) {
                showNotification('Please fill all payment details', 'error');
                return;
            }
            
            if (amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            
            if (amount > state.availableBalance) {
                showNotification('Insufficient funds for this payment', 'error');
                return;
            }
            
            // Check budget limits
            const categoryData = state.categories[category];
            const newSpent = categoryData.spent + amount;
            const utilization = (newSpent / categoryData.allocated) * 100;
            
            if (utilization > categoryData.limit) {
                showBudgetWarning(category, categoryData, amount);
                return;
            }
            
            completePayment(category, description, amount, method);
        }

        function showBudgetWarning(category, categoryData, amount) {
            document.getElementById('warning-category').textContent = categoryData.name;
            document.getElementById('warning-allocated').textContent = categoryData.allocated.toLocaleString();
            document.getElementById('warning-spent').textContent = categoryData.spent.toLocaleString();
            document.getElementById('warning-payment').textContent = amount.toLocaleString();
            document.getElementById('warning-remaining').textContent = (categoryData.allocated - categoryData.spent - amount).toLocaleString();
            
            document.getElementById('budget-warning-modal').classList.add('active');
            
            // Store payment details for later
            state.pendingPayment = { category, description: document.getElementById('payment-description').value, amount, method: document.querySelector('.payment-method.active')?.getAttribute('data-method') };
        }

        function proceedWithPayment() {
            if (state.pendingPayment) {
                completePayment(state.pendingPayment.category, state.pendingPayment.description, state.pendingPayment.amount, state.pendingPayment.method);
                delete state.pendingPayment;
            }
            closeAllModals();
        }

        function completePayment(category, description, amount, method) {
            // Update category spending
            state.categories[category].spent += amount;
            
            // Add to bills
            if (!state.categories[category].bills) {
                state.categories[category].bills = [];
            }
            
            const bill = {
                name: description,
                amount: amount,
                date: new Date().toISOString().split('T')[0],
                status: 'paid',
                method: method
            };
            
            state.categories[category].bills.push(bill);
            
            // Add to payment history
            state.paymentHistory.unshift({
                ...bill,
                category: state.categories[category].name,
                id: Date.now()
            });
            
            // Update totals and displays
            calculateBudgetTotals();
            updateAllDisplays();
            
            // Show confirmation
            showPaymentConfirmation(description, amount);
            
            // Clear form
            document.getElementById('payment-category').value = '';
            document.getElementById('payment-description').value = '';
            document.getElementById('payment-amount').value = '';
            
            showNotification(`Payment of KSh ${amount.toLocaleString()} processed successfully`, 'success');
            saveUserData();
        }

        function showPaymentConfirmation(description, amount) {
            document.getElementById('confirm-description').textContent = description;
            document.getElementById('confirm-amount').textContent = amount.toLocaleString();
            document.getElementById('transaction-id').textContent = 'TXN-' + Date.now();
            
            document.getElementById('payment-confirmation').classList.add('active');
        }

        // ===== EXPENSE TRACKING FUNCTIONS =====
        function addExpense() {
            const category = document.getElementById('expense-category').value;
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;
            
            if (!category || !description || !amount || !date) {
                showNotification('Please fill all expense details', 'error');
                return;
            }
            
            if (amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            
            const expense = {
                id: Date.now(),
                category: category,
                description: description,
                amount: amount,
                date: date,
                status: 'completed'
            };
            
            state.expenses.unshift(expense);
            
            // Clear form
            document.getElementById('expense-category').value = '';
            document.getElementById('expense-description').value = '';
            document.getElementById('expense-amount').value = '';
            document.getElementById('expense-date').value = '';
            
            renderExpenses();
            showNotification('Expense added successfully', 'success');
            saveUserData();
        }

        // ===== SAVINGS GOALS FUNCTIONS =====
        function addSavingsGoal() {
            const name = document.getElementById('goal-name').value;
            const target = parseFloat(document.getElementById('goal-target').value);
            const deadline = document.getElementById('goal-deadline').value;
            
            if (!name || !target || !deadline) {
                showNotification('Please fill all goal details', 'error');
                return;
            }
            
            if (target <= 0) {
                showNotification('Please enter a valid target amount', 'error');
                return;
            }
            
            const goal = {
                id: Date.now(),
                name: name,
                target: target,
                current: 0,
                deadline: deadline,
                completed: false
            };
            
            state.savingsGoals.push(goal);
            
            // Clear form
            document.getElementById('goal-name').value = '';
            document.getElementById('goal-target').value = '';
            document.getElementById('goal-deadline').value = '';
            
            renderSavingsGoals();
            showNotification('Savings goal created successfully', 'success');
            saveUserData();
        }

        // ===== AI ADVISOR FUNCTION =====
        function askAIAdvisor() {
            const question = document.getElementById('ai-question').value.trim();
            
            if (!question) {
                showNotification('Please enter a question for the AI advisor', 'error');
                return;
            }
            
            // Simulate AI response based on keywords
            let response = generateAIResponse(question);
            
            const recommendationsContainer = document.getElementById('ai-recommendations');
            recommendationsContainer.innerHTML = `
                <div class="alert-item">
                    <i class="fas fa-robot"></i>
                    <span><strong>AI Response:</strong> ${response}</span>
                </div>
            ` + recommendationsContainer.innerHTML;
            
            // Clear input
            document.getElementById('ai-question').value = '';
            
            showNotification('AI advisor has responded to your question', 'success');
        }

        function generateAIResponse(question) {
            const lowerQuestion = question.toLowerCase();
            
            if (lowerQuestion.includes('save') || lowerQuestion.includes('saving')) {
                return "Based on your spending patterns, I recommend setting aside 10-15% of your HELB funds for savings. Consider automating transfers to your savings goal when you receive funds.";
            } else if (lowerQuestion.includes('food') || lowerQuestion.includes('eating')) {
                return "Your food expenses are 28% above the student average. Try meal prepping and cooking with roommates to save approximately KSh 2,400 per month.";
            } else if (lowerQuestion.includes('budget') || lowerQuestion.includes('allocate')) {
                return "Your current budget allocation is good, but consider increasing your emergency fund allocation by 5%. Your transport budget has KSh 6,000 unused - consider reallocating some to food.";
            } else if (lowerQuestion.includes('emergency') || lowerQuestion.includes('unexpected')) {
                return "I recommend maintaining an emergency fund of KSh 5,000-10,000. You're at 64% of your KSh 5,000 goal - great progress!";
            } else {
                return "I've analyzed your financial data. Your overall financial health is good at 78%. Focus on reducing food expenses and consistently contributing to your savings goals. Would you like specific advice on any particular area?";
            }
        }

        // ===== RENDERING FUNCTIONS =====
        function renderBudgetCategories() {
            const container = document.getElementById('budget-categories-list');
            if (!container) return;
            
            container.innerHTML = Object.values(state.categories).map(category => `
                <div class="category-card">
                    <div class="category-header">
                        <div class="category-name">${category.name}</div>
                        <div class="category-amount">KSh ${category.allocated.toLocaleString()}</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${getProgressClass(category.spent / category.allocated)}" 
                             style="width: ${Math.min((category.spent / category.allocated) * 100, 100)}%">
                        </div>
                    </div>
                    <div class="progress-label">
                        <span>Spent: KSh ${category.spent.toLocaleString()}</span>
                        <span>Remaining: KSh ${(category.allocated - category.spent).toLocaleString()}</span>
                    </div>
                </div>
            `).join('');
        }

        function getProgressClass(ratio) {
            if (ratio < 0.7) return 'progress-safe';
            if (ratio < 0.9) return 'progress-warning';
            return 'progress-danger';
        }

        function renderBills() {
            const container = document.getElementById('bills-container');
            if (!container) return;
            
            const allBills = [];
            Object.values(state.categories).forEach(category => {
                if (category.bills) {
                    category.bills.forEach(bill => {
                        allBills.push({...bill, category: category.name});
                    });
                }
            });
            
            container.innerHTML = allBills.map(bill => `
                <div class="bill-item" style="padding: 15px; border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${bill.name}</strong>
                            <div style="color: var(--gray); font-size: 0.9rem;">${bill.category}  ${new Date(bill.date).toLocaleDateString()}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold;">KSh ${bill.amount.toLocaleString()}</div>
                            <span class="payment-status status-${bill.status}">${bill.status}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderExpenses() {
            const container = document.getElementById('expenses-list');
            if (!container) return;
            
            const recentExpenses = state.expenses.slice(0, 10);
            
            container.innerHTML = recentExpenses.map(expense => `
                <div class="expense-item">
                    <div>${expense.description}</div>
                    <div>${state.categories[expense.category]?.name || expense.category}</div>
                    <div>${new Date(expense.date).toLocaleDateString()}</div>
                    <div>KSh ${expense.amount.toLocaleString()}</div>
                    <div><span class="payment-status status-${expense.status}">${expense.status}</span></div>
                </div>
            `).join('');
        }

        function renderRecentTransactions() {
            const container = document.getElementById('recent-transactions');
            if (!container) return;
            
            const allTransactions = [];
            
            // Get bills from categories
            Object.values(state.categories).forEach(category => {
                if (category.bills) {
                    category.bills.forEach(bill => {
                        allTransactions.push({
                            ...bill,
                            category: category.name,
                            type: 'payment'
                        });
                    });
                }
            });
            
            // Get expenses
            state.expenses.forEach(expense => {
                allTransactions.push({
                    name: expense.description,
                    amount: expense.amount,
                    date: expense.date,
                    category: state.categories[expense.category]?.name || expense.category,
                    status: expense.status,
                    type: 'expense'
                });
            });
            
            // Sort by date and take latest 5
            const recent = allTransactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            container.innerHTML = recent.map(transaction => `
                <div class="expense-item">
                    <div>${transaction.name}</div>
                    <div>${transaction.category}</div>
                    <div>${new Date(transaction.date).toLocaleDateString()}</div>
                    <div>KSh ${transaction.amount.toLocaleString()}</div>
                    <div><span class="payment-status status-${transaction.status}">${transaction.status}</span></div>
                </div>
            `).join('');
        }

        function renderPaymentHistory() {
            const container = document.getElementById('payment-history-list');
            if (!container) return;
            
            const recentPayments = state.paymentHistory.slice(0, 10);
            
            container.innerHTML = recentPayments.map(payment => `
                <div class="expense-item">
                    <div>${payment.name}</div>
                    <div>${payment.category}</div>
                    <div>${new Date(payment.date).toLocaleDateString()}</div>
                    <div>KSh ${payment.amount.toLocaleString()}</div>
                    <div><span class="payment-status status-${payment.status}">${payment.status}</span></div>
                </div>
            `).join('');
        }

        function renderSavingsGoals() {
            const container = document.getElementById('savings-goals-list');
            if (!container) return;
            
            container.innerHTML = state.savingsGoals.map(goal => `
                <div class="goal-item">
                    <div style="flex: 1;">
                        <h4 style="margin-bottom: 5px;">${goal.name}</h4>
                        <p style="color: var(--gray); margin: 0;">Target: KSh ${goal.target.toLocaleString()}  Deadline: ${new Date(goal.deadline).toLocaleDateString()}</p>
                    </div>
                    <div class="goal-progress">
                        <div class="progress-bar">
                            <div class="progress-fill progress-safe" style="width: ${(goal.current / goal.target) * 100}%"></div>
                        </div>
                        <div class="progress-label">
                            <span>KSh ${goal.current.toLocaleString()} saved</span>
                            <span>${((goal.current / goal.target) * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold; color: var(--success);">KSh ${goal.current.toLocaleString()}</div>
                        <div style="color: var(--gray); font-size: 0.9rem;">of KSh ${goal.target.toLocaleString()}</div>
                    </div>
                </div>
            `).join('');
        }

        // ===== CHART INITIALIZATION =====
        function initializeCharts() {
            // Pulse Chart
            const pulseCtx = document.getElementById('pulseChart');
            if (pulseCtx) {
                new Chart(pulseCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Used', 'Available'],
                        datasets: [{
                            data: [state.spentTotal, state.availableBalance],
                            backgroundColor: ['#28a745', '#e9ecef'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        cutout: '70%',
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            tooltip: { 
                                callbacks: {
                                    label: function(context) {
                                        return `KSh ${context.raw.toLocaleString()}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Category Spending Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'pie',
                    data: {
                        labels: Object.values(state.categories).map(c => c.name),
                        datasets: [{
                            data: Object.values(state.categories).map(c => c.spent),
                            backgroundColor: [
                                '#1a5f2a', '#28a745', '#ffc107', '#dc3545', 
                                '#17a2b8', '#6c757d', '#343a40'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: KSh ${context.raw.toLocaleString()}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Monthly Trend Chart
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Monthly Spending',
                            data: [22000, 25850, 21000, 19500, 24000, 18500],
                            borderColor: '#1a5f2a',
                            backgroundColor: 'rgba(26, 95, 42, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'KSh ' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Budget vs Actual Chart
            const budgetCtx = document.getElementById('budgetChart');
            if (budgetCtx) {
                const categories = Object.values(state.categories);
                new Chart(budgetCtx, {
                    type: 'bar',
                    data: {
                        labels: categories.map(c => c.name),
                        datasets: [
                            {
                                label: 'Allocated',
                                data: categories.map(c => c.allocated),
                                backgroundColor: '#1a5f2a'
                            },
                            {
                                label: 'Spent',
                                data: categories.map(c => c.spent),
                                backgroundColor: '#28a745'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'KSh ' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // ===== QUICK PAY BUTTONS =====
        function setupQuickPayButtons() {
            document.querySelectorAll('.quick-pay-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const billType = this.getAttribute('data-bill');
                    const amounts = {
                        electricity: 1500,
                        tuition: 26000,
                        rent: 9000,
                        internet: 1200
                    };
                    
                    const descriptions = {
                        electricity: 'Electricity Bill Payment',
                        tuition: 'Tuition Fee Payment',
                        rent: 'Monthly Rent Payment',
                        internet: 'Internet Subscription'
                    };
                    
                    document.getElementById('payment-amount').value = amounts[billType];
                    document.getElementById('payment-description').value = descriptions[billType];
                    document.getElementById('payment-category').value = billType === 'tuition' ? 'tuition' : 
                                                                       billType === 'rent' ? 'accommodation' : 'utilities';
                    
                    switchPage('payments');
                    showNotification(`Quick pay for ${billType} prepared - review and confirm payment`, 'info');
                });
            });
        }

        // ===== MODAL MANAGEMENT =====
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }

        // ===== DATA PERSISTENCE =====
        function saveUserData() {
            if (currentUser) {
                const userData = {
                    state: state,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem(`helbData_${currentUser.email}`, JSON.stringify(userData));
            }
        }

        function loadUserData() {
            if (currentUser) {
                const saved = localStorage.getItem(`helbData_${currentUser.email}`);
                if (saved) {
                    try {
                        const userData = JSON.parse(saved);
                        if (userData.state) {
                            Object.assign(state, userData.state);
                        }
                    } catch (e) {
                        console.log('No saved data found or data corrupted');
                    }
                }
            }
        }

        // ===== ENHANCED FORM VALIDATION =====
        function setupFormValidation() {
            // Real-time validation for amount fields
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', function() {
                    validateAmountField(this);
                });
            });
            
            // Email validation
            document.querySelectorAll('input[type="email"]').forEach(input => {
                input.addEventListener('blur', function() {
                    validateEmailField(this);
                });
            });
            
            // Password validation
            document.querySelectorAll('input[type="password"]').forEach(input => {
                input.addEventListener('input', function() {
                    validatePasswordField(this);
                });
            });
        }

        function validateAmountField(field) {
            const value = parseFloat(field.value);
            const min = parseFloat(field.min) || 0;
            const max = parseFloat(field.max) || Infinity;
            
            clearValidation(field);
            
            if (field.value === '') {
                return true;
            }
            
            if (isNaN(value) || value < min) {
                showFieldError(field, `Amount must be at least ${min}`);
                return false;
            }
            
            if (value > max) {
                showFieldError(field, `Amount cannot exceed ${max}`);
                return false;
            }
            
            showFieldSuccess(field);
            return true;
        }

        function validateEmailField(field) {
            const email = field.value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            clearValidation(field);
            
            if (field.value === '') {
                return true;
            }
            
            if (!emailRegex.test(email)) {
                showFieldError(field, 'Please enter a valid email address');
                return false;
            }
            
            // Check for university email in signup
            if (field.id === 'signupEmail' && !email.includes('.ac.ke')) {
                showFieldError(field, 'Please use your university email address (.ac.ke)');
                return false;
            }
            
            showFieldSuccess(field);
            return true;
        }

        function validatePasswordField(field) {
            const password = field.value;
            
            clearValidation(field);
            
            if (field.value === '') {
                return true;
            }
            
            if (password.length < 6) {
                showFieldError(field, 'Password must be at least 6 characters');
                return false;
            }
            
            showFieldSuccess(field);
            return true;
        }

        function showFieldError(field, message) {
            field.classList.add('invalid');
            field.classList.remove('valid');
            
            let messageElement = field.parentNode.querySelector('.validation-message');
            if (!messageElement) {
                messageElement = document.createElement('div');
                messageElement.className = 'validation-message error';
                field.parentNode.appendChild(messageElement);
            }
            
            messageElement.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
        }

        function showFieldSuccess(field) {
            field.classList.add('valid');
            field.classList.remove('invalid');
            
            const messageElement = field.parentNode.querySelector('.validation-message');
            if (messageElement) {
                messageElement.remove();
            }
        }

        function clearValidation(field) {
            field.classList.remove('invalid', 'valid');
            
            const messageElement = field.parentNode.querySelector('.validation-message');
            if (messageElement) {
                messageElement.remove();
            }
        }

        // ===== ENHANCED APP INITIALIZATION =====
        function initializeApp() {
            if (!currentUser) return;
            
            loadUserData();
            setupNavigation();
            setupEventListeners();
            setupFormValidation();
            calculateBudgetTotals();
            updateAllDisplays();
            initializeCharts();
            setupQuickPayButtons();
            
            // Set current date for expense form
            document.getElementById('expense-date').value = new Date().toISOString().split('T')[0];
            
            showNotification(`Welcome to HELB Smart Budget, ${currentUser.name}!`, 'success');
        }

        // ===== ENHANCED NAVIGATION =====
        function setupNavigation() {
            const pages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('.nav-links li');
            const pageTitle = document.getElementById('page-title');

            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    pages.forEach(page => page.classList.remove('active'));
                    document.getElementById(pageId).classList.add('active');
                    
                    const titles = {
                        dashboard: 'Student Finance Dashboard',
                        'ai-advisor': 'AI Financial Advisor',
                        budget: 'Budget Allocation',
                        bills: 'My Bills & Payments',
                        payments: 'Make Payments',
                        expenses: 'Expense Tracking',
                        savings: 'Savings Goals',
                        analytics: 'Financial Analytics',
                        'financial-tips': 'Financial Tips',
                        'data-export': 'Data Export',
                        'profile-settings': 'Profile Settings'
                    };
                    pageTitle.textContent = titles[pageId];

                    if (pageId === 'budget') {
                        updateBudgetAllocationDisplay();
                    }
                    if (pageId === 'analytics') {
                        setTimeout(initializeCharts, 100);
                    }
                    if (pageId === 'profile-settings') {
                        loadProfileData();
                    }
                    if (pageId === 'data-export') {
                        renderExportHistory();
                    }
                });
            });
        }

        function updateBudgetAllocationDisplay() {
            // This function is called when budget page is activated
            calculateBudgetTotals();
            renderBudgetCategories();
        }

        // ===== UTILITY FUNCTIONS =====
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Start with login system
        document.addEventListener('DOMContentLoaded', function() {
            initializeLoginSystem();
        });
    </script>
</body>
</html>